# Relay Realtime Game Server

## Сущности

### Комната
- Совокупность клиентов и игровых объектов для организации сессионого взаимодействия (битвы)
- Обладает ограниченным временем жизни

### Клиент
- связь с удаленным приложением
- поддержка реконнекта (?)

### Игровой объект
- Асбтракция для объедения данных, команд и групп доступа.
- У объекта есть владелец - либо клиент либо root
- При удалении владельца - объект удаляется из комнаты 

#### Идентификатор объекта
Для адресации объектов используется u64 идентификатор.
Идентификатор составной - userId:localGameObjectId
- userId:u16 - идентификатор пользователя владельца, или 0 для root объектов
- localGameObjectId:u32 - локальный идентификатор объекта, за его инкремент отвечает клиент
   


## Способы взаимодействия клиентов
 
### Обмен событиями
### Обмен данными
### Кворумные события
- клиент подписывается на кворумное событие, обработчик вызовется если N клиентов послали данное событие.
- кворумное событие рассылается по объекту
- у кворумного события могут быть параметры, но кворум определяется по типу события, а не по его содержимому
- в обработчик кворумного события передаются список событий с клиентов
- правила вызова кворумного события - N клиентов должны его послать, но ожидание его не более M времени

## Данные объектов
### Адресация полей
Для адресации полей используется u16, идентификаторы полей уникальные в рамках типа поля.
То есть может быть поле типа Counter с идентификатором 1 и поле типа Struct с идентификатором 1
### Типы данных
- счетчик - i64 (LongCounter)
- счетчик - f64 (FloatCounter)
- структуры 
- Map<String, u64>
- Set<u64>



## Группы доступа

- Игровые объекты и клиенты находятся в группах доступа. 
- Каждая группа доступа имеет идентификатор из диапазона 0-63.
- Клиент может изменять только те объекты, в группах которых он находится.
- Также изменения объекта рассылается всем клиентам, у которых с объектом есть общие группы.
- 

## Коннект клиента
- клиент пересылает серверу свой hash и hash комнаты