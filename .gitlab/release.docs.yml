build-docs-charts:
  extends:
    - .docker-dind-tls
  only:
    refs:
      - tags
  stage: release
  image: docker:20.10.14-dind
  variables:
    version: $CI_COMMIT_TAG
  script:
    - docker login -u $CI_DEPLOY_USER -p $CI_DEPLOY_PASSWORD registry.dev.cheetah.games/cheetah/
    - cd docs/public/ && ./deploy-image.sh $version

deploy-docs-charts:
  only:
    refs:
      - tags
  stage: release
  image: registry.dev.cheetah.games/cheetah/images/helm-builder:1.0.0
  needs:
    - build-docs-charts
  variables:
    version: $CI_COMMIT_TAG
  script:
    - cd hosting/charts && KUBECONFIG=$kubeconfig ./update-user-portal.sh $version
