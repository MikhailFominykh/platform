release-unity-packages:
  only:
    refs:
      - tags
  stage: release
  image: node:17.7.2-stretch-slim
  variables:
    version: $CI_COMMIT_TAG
  script: |-
    cd clients/Unity/Packages/
    for package in  $(ls -d */)
    do
      cd  $package
      sed -i.bak "s/999.999.999/${version}/" package.json
      rm -f package.json.bak
      echo "${CI_API_V4_URL#https?}/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=\${CI_JOB_TOKEN}" > .npmrc
      npm publish .
      cd ../
    done