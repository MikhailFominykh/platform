# Просмотр команд relay сервера из Unity для отладкт

## Статус

Принят

## Контекст и постановка проблемы

Для понимания происходящего между клиентом и сервером и поиска ошибок необходимы инструменты отладки, одним из таких
инструментов может быть возможность посмотреть и провести анализ потока команд между клиентом и сервером.

## Обзор вариантов решений

- Отображение через консольную утилиту
- Отображение через браузер
- Отображение в редакторе Unity

## Выбранное решение

Так как есть гипотеза, что удобнее работать не выходя из Unity - то принимаем решение использовать Unity UI для
отображения команд. Это также (в теории) позволит провести интеграцию с другими инструментами в Unity, но пока не
понятно с какими.

## Детали решения

### Состав команды

- комната
- пользователь
- направление (user->server, server->user)
- объект (шаблон + id)
- команда
- данные команды

### Фильтрация

За основу предлагается взять текстовый язык составления правил фильтрации.

```
direction=s2c && !command=move && user=100
```

Сокращенный вариант

```
d=s2c && c!=move && u=100
```

### Раскрытие данных о сущностях

Relay сервер оперирует числовыми идентификаторами для команд/шаблонов и групп. Что оправданно в качестве мере снижения
трафика и быстродействия. Однако человеку сложно сопоставлять идентификаторы с игровыми сущностями. Поэтому нужен
механизм отображения текстовых названий сущностей вместо чисел.

Все нужная информация есть у сервиса Factory в конфигурации комнат. Формат конфигурации предусматривает опциональное
задание имен сущностей, однако если имя задано - то Factory может выдать эту информацию через grpc сервис.

Второй вариант - брать информацию из текущего Unity проекта, но как мне кажется не самый оптимальный вариант, так как
она может различаться с информацией на сервере. Плюс к этому еще нет понимания middle level Relay клиента, из которого
можно было вытащить дополнительные данные. То есть не откидываем данный вариант, но и не используем его в текущем
моменте.

### Возможности панели в Unity

- отображение списка команд в табличном виде, с возможностью настраивать количество столбцов
- ввод и применения фильтра
- навигация по истории фильтров
- выгрузка и загрузка команд из файла (но скорее всего не из csv, так как есть дополнительная информацию по раскрытию
  имен сущностей)

## Задачи по внедрению решения

- [ ] gRPC сервис для получения информации о названиях сущностей (проект server/matches/Factory)
- [ ] Функция фильтрации структур по текстовому запросу (проект server/matches/Relay)
- [ ] gRPC сервис для получения списка команд в реальном времени с учетом запроса
- [ ] Перенос Unity проекта в основную ветку
- [ ] Интеграция gRPC сервиса в Unity
- [ ] Выгрузка/загрузка csv в Unity панель
- [ ] Проверка работы текстовой строки (история, поиск)
- [ ] Проверка сохранения фильтров для поиска
- [ ] Проверка сохранения включения/выключению столбцов для отображения
